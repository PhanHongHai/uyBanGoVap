<!DOCTYPE html>
<html lang="en">
<% include ../../component/headAdmin %>

<body>
    <div class="dashboard-main-wrapper">
        <!-- sidebar -->
        <%- include('../../component/sideBarAdmin',{user}) %>
        <!-- End sidebar -->
        <div class="dashboard-wrapper">
            <div class="container-fluid dashboard-content">
                <div class="row">
                    <div class="col-xl-12">
                        <!-- ============================================================== -->
                        <!-- pageheader  -->
                        <!-- ============================================================== -->
                        <div class="row">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                <div class="page-header" id="top">
                                    <h2 class="pageheader-title">QL Tài Khoản </h2>
                                    <%- include('../../component/breadCrumb',{link}) %>
                                </div>
                            </div>
                        </div>
                        <!-- ============================================================== -->
                        <!-- end pageheader  -->
                        <!-- ============================================================== -->
                        <!-- ============================================================== -->
                        <div class="row">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-lg-10">
                                                <h3>Danh sách tài khoản</h3>
                                            </div>
                                            <div class="col-lg-2">
                                                <!-- Button trigger modal -->
                                                <button type="button" class="btn btn-primary" data-toggle="modal"
                                                    data-target="#modalAđ">
                                                    Thêm
                                                </button>

                                                <!-- Modal -->
                                                <div class="modal fade" id="modalAđ" tabindex="-1" role="dialog"
                                                    aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-scrollable" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"
                                                                    id="exampleModalScrollableTitle">Thêm mới</h5>
                                                                <button type="button" class="close" data-dismiss="modal"
                                                                    aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form method="POST" action="/admin/tai-khoan">
                                                                    <div class="form-group">
                                                                        <label for="inputSmall"
                                                                            class="col-form-label">Username</label>
                                                                        <input id="inputSmall" type="text"
                                                                            class="form-control form-control-sm"
                                                                            name="username" novalidate>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="inputDefault"
                                                                            class="col-form-label">Password</label>
                                                                        <input id="inputDefault" type="text"
                                                                            class="form-control" name="password"
                                                                            novalidate>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="input-select">Quyền</label>
                                                                        <select class="form-control" id="input-select"
                                                                            name="role" novalidate>
                                                                            <option value="1">Admin</option>
                                                                            <option value="2">Nhân viên</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary"
                                                                            data-dismiss="modal">Thoát</button>
                                                                        <button type="submit"
                                                                            class="btn btn-primary">Xác Nhận</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card-body">
                                        <div class="table-responsive ">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">STT</th>
                                                        <th scope="col">Username</th>
                                                        <th scope="col">Password</th>
                                                        <th scope="col">Quyền</th>
                                                        <th scope="col">Xử lý</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% if(acc){
                                                        let i=1;
                                                    acc.forEach(function(ele){
                                                    %>

                                                    <tr>
                                                        <th scope="row"><%= i %></th>
                                                        <td><%= ele.username %></td>
                                                        <td><%= ele.password %></td>
                                                        <td><%= ele.role %></td>
                                                        <td>
                                                            <i class="fas fa-edit pr-3 " data-toggle="modal"
                                                                data-target="#modalEdit<%=i%>"
                                                                style="cursor:pointer;"></i>
                                                            <i class="fas fa-trash-alt nutDelete"  style="cursor:pointer;"></i>
                                                        </td>
                                                        <!-- Button trigger modal -->
                                                        <!-- Modal -->
                                                        <input type="hidden" name="" id="id"
                                                                            value="<%= ele._id %>">
                                                        <div class="modal fade" id="modalEdit<%= i %>" tabindex="-1"
                                                            role="dialog" aria-labelledby="exampleModalScrollableTitle"
                                                            aria-hidden="true">
                                                            <div class="modal-dialog modal-dialog-scrollable"
                                                                role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title"
                                                                            id="exampleModalScrollableTitle">Sửa Thông
                                                                            tin
                                                                        </h5>
                                                                        <button type="button" class="close"
                                                                            data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="form-group">
                                                                            <label for="inputSmall"
                                                                                class="col-form-label">Tên tài
                                                                                khoản</label>
                                                                            <input id="us" type="text"
                                                                                class="form-control form-control-sm"
                                                                                value="<%= ele.username %>"
                                                                                name="username" required>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="inputDefault"
                                                                                class="col-form-label">Mật Khẩu</label>
                                                                            <input id="pass" type="text"
                                                                                class="form-control" name="password"
                                                                                value="<%= ele.password %>" required>
                                                                        </div>

                                                                        <div class="form-group">
                                                                            <label for="input-select">Quyền</label>
                                                                            <select class="form-control" id="role"
                                                                                name="role">
                                                                                <% var roleTemp=["Admin","Nhân Viên"]
                                                                                    for(var count = 1; count <=2 ; count++){
                                                                                %>
                                                                                <% if(ele.role == count){ %>
                                                                                <option value="<%= count%>" selected>
                                                                                    <%= roleTemp[count-1] %></option>
                                                                                <% } else{ %>

                                                                                <option value="<%= count%>">
                                                                                    <%= roleTemp[count-1] %></option>
                                                                                <% }} %>

                                                                            </select>
                                                                        </div>
                                                                        
                                                                        <div class="modal-footer">
                                                                            <button type="button"
                                                                                class="btn btn-secondary"
                                                                                data-dismiss="modal">Thoát</button>
                                                                            <button type="submit"
                                                                                class="btn btn-primary nutEdit">Xác
                                                                                Nhận</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </tr>
                                                    <% i++; })} %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
 
    <div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;">
        <div class="toast" style="position: absolute; top: 0; right: 0;" data-delay="1000">
            <div class="toast-header">
                <strong class="mr-auto">Thông báo !</strong>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
               False
            </div>
        </div>
    </div>


</body>
<script src="/public/js/jquery.min.js"></script>
<!-- bootstap bundle js -->
<script src="/public/js/bootstrap.bundle.js"></script>
<script src="/public/js/Toast.js"></script>
<!-- slimscroll js -->
<script src="/public/js/slimscroll/jquery.slimscroll.js"></script>
<!-- main js -->
<script src="/public/js/main-js.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('.nutEdit').click(function () {
            let us = $('#us').val();
            let pass = $('#pass').val();
            let role = $('#role').val();
            let id = $('#id').val();
            let data = {
                username: us,
                password: pass,
                role: role
            };
            $.ajax({
                contentType: 'application/json',
                url: '/admin/tai-khoan/' + id,
                dataType: 'json',
                data: JSON.stringify(data)
            })
                .done((res) => {
                    if (res.succes) {
                        window.location.reload();
                    }
                    else {
                        $('.toast').toast('show');
                    }
                });

        });
        $('.nutDelete').click(function(){
            let confirmText="Bạn có muốn xóa không ?";
            let id = $('#id').val();
            console.log(id);
            if(confirm(confirmText)){
                $.ajax({
                    type:'DELETE',
                    url:'/admin/tai-khoan/'+id
                }).done((res) => {
                   console.log(res);
                });
            }
        });
        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        });
    });


</script>

</html>